@model Sistema_Tea.Models.ADOS2_TareaDefinicion

<h2>@Model.NombreTarea</h2>
<p><strong>Descripción:</strong> @Model.Descripcion</p>
<p><strong>Instrucciones:</strong> @Model.InstruccionesAdministracion</p>

<form asp-action="GuardarYContinuar" method="post">
    <input type="hidden" name="sesionId" value="@ViewBag.SesionId" />
    <input type="hidden" name="tareaDefinicionId" value="@Model.TareaDefinicionID" />
    <input type="hidden" name="tareaIndex" value="@ViewBag.TareaIndex" />

    <div class="form-group">
        <label for="codigoObservado">Puntuación:</label>
        <select id="codigoObservado" name="codigoObservado" class="form-control" required>
            <option value="">--Seleccione--</option>
            <option value="0">0 - Sin evidencia anormal</option>
            <option value="1">1 - Comportamiento ligeramente anormal</option>
            <option value="2">2 - Comportamiento moderadamente anormal</option>
            <option value="3">3 - Comportamiento severamente anormal</option>
            <option value="7">7 - No aplicable</option>
            <option value="8">8 - No puntuable</option>
            <option value="9">9 - No observado</option>
        </select>
    </div>

    <div class="form-group">
        <label for="notasObservacionItem">Notas de observación (opcional):</label>
        <textarea id="notasObservacionItem" name="notasObservacionItem" class="form-control" rows="4"
                  placeholder="Describa comportamientos específicos observados..."></textarea>
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-primary">Guardar</button>

        @if (ViewBag.TareaIndex > 0)
        {
            <a href="@Url.Action("TareasModulo", new { sesionId = ViewBag.SesionId, tareaIndex = ViewBag.TareaIndex - 1 })"
               class="btn btn-secondary">Tarea Anterior</a>
        }

        @if (ViewBag.TareaIndex + 1 < ViewBag.TotalTareas)
        {
            <a href="@Url.Action("TareasModulo", new { sesionId = ViewBag.SesionId, tareaIndex = ViewBag.TareaIndex + 1 })"
               class="btn btn-secondary">Siguiente</a>
        }

        <button type="button" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modalPausar">
            Pausar
        </button>
    </div>
</form>

<div class="modal fade" id="modalPausar" tabindex="-1" aria-labelledby="modalPausarLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalPausarLabel">Confirmar pausa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                ¿Está seguro que desea pausar la sesión? Podrá reanudarla más tarde.
            </div>
            <div class="modal-footer">
                <form asp-action="PausarSesion" method="post">
                    <input type="hidden" name="id" value="@ViewBag.SesionId" />
                    <input type="hidden" name="nota" value="Pausado por el usuario" />

                    <button type="submit" class="btn btn-warning">Sí, pausar</button>
                </form>
            </div>
        </div>
    </div>
</div>
